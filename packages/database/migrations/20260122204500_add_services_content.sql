-- Migration: Create services table and populate with Repair and Modernization content
-- Timestamp: 20260122204500

CREATE TABLE IF NOT EXISTS services (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    slug VARCHAR(50) NOT NULL UNIQUE,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    content JSONB,
    sort_order INTEGER DEFAULT 0,
    is_published BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Insert Repair and Modernization service
INSERT INTO services (slug, title, description, content, sort_order) VALUES
(
    'remont-i-modernizatsiya', 
    'Капитальный ремонт и Модернизация промышленного оборудования', 
    'Комплексное восстановление паспортной точности и глубокая модернизация систем управления станочного парка.',
    '{
      "checklist_title": "Регламент технических операций при капитальном ремонте",
      "checklist": [
        "Шлифовка и шабрение направляющих станины, кареток и суппортов",
        "Замена винтовых пар качения (ШВП) на прецизионные аналоги (класс точности П и В)",
        "Замена подшипниковых опор шпиндельных узлов с восстановлением посадочных мест",
        "Монтаж современных систем ЧПУ (Fanuc, Siemens, NC-210) «под ключ»",
        "Сборка электрошкафов на базе компонентов Rittal и Schneider Electric",
        "Полная замена гидроаппаратуры и восстановление герметичности гидросистемы",
        "Установка оптических линеек (ИСУ) для компенсации люфтов и повышения точности",
        "Ревизия и ремонт коробок скоростей и подач с заменой изношенных шестерен",
        "Восстановление геометрии поворотных столов и делительных головок",
        "Замена системы СОЖ с установкой современных фильтрующих модулей",
        "Монтаж автоматических систем смазки и контроля давления",
        "Восстановление или изготовление новых защитных ограждений (телескопическая защита)",
        "Ремонт и балансировка инструментальных магазинов и автосменщиков",
        "Шлифовка конуса шпинделя и калибровка усилия зажима инструмента",
        "Ремонт задних бабок и люнетов с восстановлением соосности",
        "Малярные работы: очистка до голого металла и окраска стойкими полиуретановыми эмалями",
        "Разработка новой технической документации и паспорта станка",
        "Пусконаладочные работы с проверкой по ГОСТ 8-82 (точность) и ГОСТ 7599-82 (жесткость)",
        "Проведение лазерной интерферометрии для компенсации погрешностей шага",
        "Инструктаж персонала по работе с обновленным программным обеспечением"
      ],
      "cases": [
        {
          "model": "Токарно-винторезный станок 16К20",
          "problem": "Потеря геометрической точности, критический износ направляющих («яма» 0.2мм), устаревшая электрика.",
          "solution": "Проведена шлифовка станины на портальном станке, установлены ШВП по осям X и Z, смонтирована система УЦИ.",
          "result": "Восстановлена паспортная точность. Конусность на длине 300мм не превышает 0.01мм. Ресурс продлен на 10 лет."
        },
        {
          "model": "Вертикально-фрезерный станок 6Р13",
          "problem": "Разбиты посадочные места шпинделя, неисправность коробки скоростей, низкая производительность.",
          "solution": "Замена шпиндельного узла, установка частотного преобразователя для бесступенчатого регулирования, ремонт электроавтоматики.",
          "result": "Снижение энергопотребления на 30%. Возможность обработки на скоростях до 2500 об/мин без вибраций."
        },
        {
          "model": "Токарно-карусельный станок 1512",
          "problem": "Моральное устаревание релейной логики, ошибки позиционирования планшайбы, течи масла.",
          "solution": "Глубокая модернизация: установка ЧПУ Fanuc 0i-TF, замена приводов на сервомоторы, полная замена гидравлики.",
          "result": "Время обработки сложных деталей сокращено в 2.5 раза. Точность позиционирования по осям — 0.015мм."
        }
      ],
      "usp": [
        {
          "title": "Бескомпромиссная гарантия",
          "description": "Предоставляем расширенную гарантию 24 месяца на все узлы и программное обеспечение."
        },
        {
          "title": "Мобильный сервис",
          "description": "Выезд аварийной бригады инженеров на объект в течение 24 часов с момента заявки."
        },
        {
          "title": "Прозрачность и НДС",
          "description": "Официальный договор, работаем с НДС 20%, полный комплект бухгалтерских и технических документов."
        },
        {
          "title": "Минимизация простоя",
          "description": "Располагаем подменным фондом основных узлов и агрегатов для оперативной замены на время ремонта."
        }
      ]
    }'::jsonb,
    1
)
ON CONFLICT (slug) DO UPDATE SET 
    title = EXCLUDED.title,
    description = EXCLUDED.description,
    content = EXCLUDED.content,
    updated_at = NOW();
