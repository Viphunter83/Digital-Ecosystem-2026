# ะะฝััััะบัะธั ะฟะพ ะธะฝัะตะณัะฐัะธะธ AmoCRM: Digital Ecosystem 2026

ะะตััะธั: 2.2 (ะะบััะฐะปะธะทะธัะพะฒะฐะฝะพ: 26.02.2026 โ ะะตัะตะตะทะด ะฝะฐ Beget)

## ๐ ะะฑะทะพั
ะะฝัะตะณัะฐัะธั ะพะฑะตัะฟะตัะธะฒะฐะตั ะดะฒัััะพัะพะฝะฝะธะน ะพะฑะผะตะฝ ะดะฐะฝะฝัะผะธ ะผะตะถะดั ะฟะปะฐััะพัะผะพะน ยซะััะกัะฐะฝะบะพะกะฑััยป ะธ AmoCRM ะดะปั ะฐะฒัะพะผะฐัะธะทะฐัะธะธ ะฟัะพะดะฐะถ ะธ ัะตัะฒะธัะฝะพะณะพ ะพะฑัะปัะถะธะฒะฐะฝะธั.

### ะัะฝะพะฒะฝัะต ะฟะพัะพะบะธ ะดะฐะฝะฝัั:
1. **ะกะฐะนั/TMA โ AmoCRM**: ะกะพะทะดะฐะฝะธะต ัะดะตะปะพะบ (leads) ะฟัะธ ะทะฐะฟัะพัะต ัะตัะฒะธัะฐ ะธะปะธ ะฟะพะบัะฟะบะต ะทะฐะฟัะฐััะตะน.
2. **AmoCRM โ TMA**: ะะตะณะธัััะฐัะธั ะพะฑะพััะดะพะฒะฐะฝะธั ะฒ ยซะฆะธััะพะฒะพะผ ะะฐัะฟะพััะตยป ะบะปะธะตะฝัะฐ ะฟัะธ ััะฟะตัะฝะพะผ ะทะฐะบัััะธะธ ัะดะตะปะบะธ.
3. **ะะฒัััะพัะพะฝะฝัั ัะธะฝััะพะฝะธะทะฐัะธั**: ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะพะฒ ะพะฑัะปัะถะธะฒะฐะฝะธั ะธ ะดะฐั ะขะ.

---

## โ ะะตัะธัะธัะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต (Production)

ะะธะถะต ะฟัะธะฒะตะดะตะฝั ID ะธ ะฝะฐัััะพะนะบะธ, ะบะพัะพััะต ะฟัะพัะปะธ ะฟัะพะฒะตัะบั ะธ ัะฐะฑะพัะฐัั ะฝะฐ ะฟัะพะดะฐะบัะฝ-ัะตัะฒะตัะต:

### 1. ะะพัะพะฝะบะธ ะธ ััะฐัััั
- **ะัะฝะพะฒะฝะฐั ะฒะพัะพะฝะบะฐ**: ยซะะปะธะตะฝัั ะะะยป โ ID `10226282`
- **ะะบัะธะฒะฝัะน ััะฐััั**: ยซะะฐัะฒะบะฐยป โ ID `80953554`
- **ะัะฒะตัััะฒะตะฝะฝัะน ะผะตะฝะตะดะถะตั**: ID `12380450`

### 2. ะขะตัะฝะธัะตัะบะธะต ะฟะฐัะฐะผะตััั ะธะฝัะตะณัะฐัะธะธ
- **Redirect URL**: `https://api.td-rss.ru/webhook/amocrm` (ะะะะขะะงะะ ะดะปั OAuth2)
- **Subdomain**: `new599bd9d13818a` (ะขะตัะฝะธัะตัะบะธะน ะฟะพะดะดะพะผะตะฝ)
- **Integration ID (Client ID)**: `2df855f6-d54d-4c3c-bb8a-1d8ea8b3c1cd`

### 3. ะะฐัััะพะนะบะฐ ะฟะพะปะตะน
ะะพะดัะฒะตัะถะดะตะฝะฝัะต ID ะฟะพะปะตะน ะฒ ัะฐะทะดะตะปะต ยซะกะดะตะปะบะธยป:
- **ะกะตัะธะนะฝัะน ะฝะพะผะตั**: ID `712629`
- **ะะพะดะตะปั ะพะฑะพััะดะพะฒะฐะฝะธั**: ID `712631`
- **Telegram ID**: ID `712633`

---

## ๐ ะะฐัััะพะนะบะฐ ะะฝัะตะณัะฐัะธะธ

### 1. ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (Dokploy)
ะะปั ัะฐะฑะพัั ะธะฝัะตะณัะฐัะธะธ ะฒ ะฝะฐัััะพะนะบะฐั **Backend** ัะตัะฒะธัะฐ ะดะพะปะถะฝั ะฑััั ัััะฐะฝะพะฒะปะตะฝั ัะปะตะดัััะธะต ะฟะฐัะฐะผะตััั:

### 1.1 ะะพะปะณะพััะพัะฝะฐั ะฐะฒัะพัะธะทะฐัะธั (Long-lived Token)
ะ ัะตะฒัะฐะปะต 2026 ะณะพะดะฐ ัะธััะตะผะฐ ะฑัะปะฐ ะฟะตัะตะฒะตะดะตะฝะฐ ะฝะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต **ะดะพะปะณะพััะพัะฝะพะณะพ ัะพะบะตะฝะฐ**, ะบะพัะพััะน ะดะตะนััะฒะธัะตะปะตะฝ ะดะพ **09.02.2031**. 

*   **ะัะตะธะผััะตััะฒะฐ**: ะัะบะปััะฐะตั ัะธัะบ ยซะฒัะปะตัะฐยป ะฐะฒัะพัะธะทะฐัะธะธ ะฟัะธ ัะฑะพะต ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั (refresh).
*   **ะะพะณะธะบะฐ**: ะขะพะบะตะฝ ะถะตััะบะพ ะฟัะพะฟะธัะฐะฝ ะฒ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั ะฝะฐ ัะตัะฒะตัะต. ะัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะตะณะพ ะผะพะถะฝะพ ะพะฑะฝะพะฒะธัั ัะตัะตะท ะฟะพะฒัะพัะฝัั ะฐะฒัะพัะธะทะฐัะธั, ะฝะพ ะฒ ััะฐัะฝะพะผ ัะตะถะธะผะต ะฒะผะตัะฐัะตะปัััะฒะพ ะฝะต ััะตะฑัะตััั.
*   **ะะตะทะพะฟะฐัะฝะพััั**: ะะพัััะฟ ะพะณัะฐะฝะธัะตะฝ ัะฟะธัะบะพะผ ัะฐะทัะตัะตะฝะฝัั IP-ะฐะดัะตัะพะฒ ะฑัะบะตะฝะดะฐ.

> [!IMPORTANT]
> ะัะปะธ ะธะฝัะตะณัะฐัะธั ะฒัะดะฐะตั ะพัะธะฑะบั 401, ะฒะตัะพััะฝะตะต ะฒัะตะณะพ, `Refresh Token` ััะฐะป ะฝะตะดะตะนััะฒะธัะตะปะตะฝ. ะขัะตะฑัะตััั ะฟะพะฒัะพัะฝะฐั ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท ะฟะพะปััะตะฝะธะต ะฝะพะฒะพะณะพ `auth_code` ะฒ ะฟะฐะฝะตะปะธ AmoCRM.

### 2. ะะฐัััะพะนะบะฐ ะฒะตะฑััะบะพะฒ
ะ ะฝะฐัััะพะนะบะฐั AmoCRM (ะะฐะทัะฐะฑะพััะธะบะฐะผ -> ะะตะฑััะบะธ) ะดะพะฑะฐะฒะปะตะฝ URL:
`https://api.td-rss.ru/webhook/amocrm`

---

## ๐ ะะธะฐะณะฝะพััะธะบะฐ ะธ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะขะธะฟะพะฒัะต ะพัะธะฑะบะธ ะฟัะธ ะฐะฒัะพัะธะทะฐัะธะธ:

1. **"Incorrect client"**: 
   - **ะัะธัะธะฝะฐ**: ะะพะฟััะบะฐ ะพะฑะฝะพะฒะธัั ัะพะบะตะฝ (refresh) ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ `Client ID` ะธะปะธ `Client Secret`, ะบะพัะพััะต ะฝะต ัะพะพัะฒะตัััะฒััั ัะตะผ, ััะพ ะธัะฟะพะปัะทะพะฒะฐะปะธัั ะฟัะธ ะฒัะดะฐัะต ัะตะบััะตะณะพ `Refresh Token`.
   - **ะะตัะตะฝะธะต**: ะัะพะฒะตัััะต ัะตะบัะตัะฝัะน ะบะปัั ะฒ Dokploy. ะัะปะธ ะพะฝ ะผะตะฝัะปัั โ ะฝัะถะฝะพ ะทะฐะฝะพะฒะพ ะฟะพะปััะธัั `auth_code`.

2. **"Cannot decrypt the authorization code"**:
   - **ะัะธัะธะฝะฐ**: ะะตัะพะฒะฟะฐะดะตะฝะธะต `Redirect URI` ะฒ ะบะพะดะต ะธ ะฒ ะฝะฐัััะพะนะบะฐั AmoCRM.
   - **ะะตัะตะฝะธะต**: ะฃะฑะตะดะธัะตัั, ััะพ ะฒ AmoCRM ะฟัะพะฟะธัะฐะฝะพ ะธะผะตะฝะฝะพ `https://api.td-rss.ru/webhook/amocrm`.

3. **"401 Unauthorized"**:
   - **ะัะธัะธะฝะฐ**: ะะตะฒะตัะฝัะน ะธะปะธ ะฟัะพััะพัะตะฝะฝัะน `Access Token`.
   - **ะะตัะตะฝะธะต**: ะกะธััะตะผะฐ ะดะพะปะถะฝะฐ ะพะฑะฝะพะฒะธัั ะตะณะพ ัะฐะผะฐ. ะัะปะธ ะฝะต ะผะพะถะตั โ ะฟัะพะฒะตัััะต ะปะพะณะธ ะฝะฐ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ 1 ะธะปะธ 2.

### ะะฐะบ ะฟัะพะฒะตัะธัั ัะฒัะทั:
- **ะขะตััะพะฒัะน ัะฝะดะฟะพะธะฝั**: `GET https://api.td-rss.ru/ingest/test-crm`
  - *ะะถะธะดะฐะตะผัะน ะพัะฒะตั*: `{"status":"success","amo_lead_id":...}`

---

## ๐ ะะพะณะธะบะฐ ัะฐะฑะพัั ะบะพะดะฐ

- **leads.py**: ะขะพัะบะฐ ะฒัะพะดะฐ ะดะปั ะฒัะตั ะพะฑัะฐัะตะฝะธะน (ัะฐะนั, ะฑะพั, ะบะพัะทะธะฝะฐ). ะัะฟะพะปัะทัะตั `BackgroundTasks` ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ, ััะพะฑั ะฝะต ะฑะปะพะบะธัะพะฒะฐัั UI.
- **amocrm.py**: ะะปะธะตะฝั ะฝะฐ ะฑะฐะทะต `aiohttp`. ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะดััะฐะฒะปัะตั `Pipeline ID` ะธ `Status ID` ะธะท ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั, ะตัะปะธ ะพะฝะธ ะฝะต ะฟะตัะตะดะฐะฝั ัะฒะฝะพ.
- **ะะฝัะตะณัะฐัะธั ั ะฟะพััะพะน (Mail Sync 2.0)**: 
  ะ ัะตะฒัะฐะปะต 2026 ะฟะพััะฐ ะฟะตัะตะฒะตะดะตะฝะฐ ั RU-CENTER ะฝะฐ **Beget**.
  - **IMAP**: `imap.beget.com` (ะะพัั 993, SSL)
  - **SMTP**: `smtp.beget.com` (ะะพัั 465, SSL)
  - **ะะพะณะธะบะฐ**: AmoCRM ะฟะพะดะบะปััะฐะตััั ะบ ััะธะบั `zakaz@tdrusstankosbyt.ru`. ะัะต ะฒัะพะดััะธะต ะฟะธััะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั ัะดะตะปะบะธ ะธะปะธ ะฟัะธะฒัะทัะฒะฐัััั ะบ ัััะตััะฒัััะธะผ ะบะพะฝัะฐะบัะฐะผ.
  - **ะะตะทะพะฟะฐัะฝะพััั**: ะะปั ะบะพััะตะบัะฝะพะน ัะฐะฑะพัั ะฒ DNS (RU-CENTER) ะฟัะพะฟะธัะฐะฝั ะทะฐะฟะธัะธ SPF, DKIM ะธ DMARC. ะะตะท ะฝะธั AmoCRM ะผะพะถะตั ะฟะพะผะตัะฐัั ะฟะธััะผะฐ ะบะฐะบ ัะฟะฐะผ.

> [!IMPORTANT]
> ะัะธ ัะผะตะฝะต ะฟะฐัะพะปั ะพั ะฟะพััั `zakaz@...` ะตะณะพ ะฝะตะพะฑัะพะดะธะผะพ **ะะะฏะะะขะะะฌะะ** ะพะฑะฝะพะฒะธัั ะฒ ะฝะฐัััะพะนะบะฐั AmoCRM (ัะฐะทะดะตะป ยซะะพััะฐยป -> ยซะะฐัััะพะนะบะธยป), ะธะฝะฐัะต ัะธะฝััะพะฝะธะทะฐัะธั ะปะธะดะพะฒ ะฟัะตัะฒะตััั.
