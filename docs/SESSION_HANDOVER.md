# Handover: Session 26.02.2026 - Mail Integration & Deliverability Hardening

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–∏ —Å–µ—Å—Å–∏–∏ –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ø–æ—á—Ç–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AmoCRM.

## üöÄ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚úÖ

### 1. –ü–æ—á—Ç–∞ –∏ AmoCRM (Mail 2.0)
*   **–ú–∏–≥—Ä–∞—Ü–∏—è**: –ü–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω —Å RU-CENTER –Ω–∞ Beget. –≠—Ç–æ —Ä–µ—à–∏–ª–æ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é SMTP.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Spam Resistance)**: –í–Ω–µ–¥—Ä–µ–Ω—ã –∑–∞–ø–∏—Å–∏ **SPF**, **DKIM** (—Å–µ–ª–µ–∫—Ç–æ—Ä `beget`) –∏ **DMARC** (`p=none`) –≤ –ø–∞–Ω–µ–ª–∏ RU-CENTER. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É –ø–∏—Å–µ–º –≤ ¬´–í—Ö–æ–¥—è—â–∏–µ¬ª ( Mail.ru, Gmail –∏ –¥—Ä.).
*   **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: AmoCRM –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—ã–µ IMAP/SMTP —Å–µ—Ä–≤–µ—Ä—ã Beget. –ü–æ—Ç–æ–∫ –ø–∏—Å–µ–º –≤ CRM –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
*   **–ë—ç–∫–µ–Ω–¥**: –í `.env` –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `SMTP_HOST=smtp.beget.com`, `SMTP_USER=zakaz@td-rss.ru`.

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Legacy Routes
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞ —Å—Ç–∞—Ä—ã–µ —Ñ–æ—Ä–º—ã –Ω–∞ —Å–∞–π—Ç–µ (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `/leads`) –Ω–∞—á–∞–ª–∏ –≤—ã–¥–∞–≤–∞—Ç—å 404.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `apps/backend/app/main.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–ª—É—à–∫–∏-—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ `/leads` –∏ `/leads/leads`. –¢–µ–ø–µ—Ä—å —Å—Ç–∞—Ä—ã–µ —Ñ–æ—Ä–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞—é—Ç –ª–∏–¥—ã –≤ –±–∞–∑–µ –∏ AmoCRM.

### 3. –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (Bot & Webhooks)
*   **Bot Conflict**: –£—Å—Ç—Ä–∞–Ω–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç `409 Conflict: terminated by other getUpdates`. –£–¥–∞–ª–µ–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
*   **Webhook Loop**: –í–Ω–µ–¥—Ä–µ–Ω–∞ Redis-–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤ Directus. –≠—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –Ω–∞–ª–æ–∂–µ–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## üìã –ü–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö e-mail –∞–¥—Ä–µ—Å–æ–≤ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è).
- **Directus Automation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ (flows) –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–±—Ö—É–∫–æ–≤.

---
# Handover: Session 10.02.2026 - Website Recovery & Content Logic

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–∏ —Å–µ—Å—Å–∏–∏ –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é —Å–∞–π—Ç–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ª–æ–≥–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

## üöÄ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚úÖ
–ü–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ, –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

### 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Docker & Dokploy)
*   **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–∞ 3000. –í `docker-compose.prod.yml` —É–¥–∞–ª–µ–Ω –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç, —Ç–µ–ø–µ—Ä—å Traefik —Ä–æ—É—Ç–∏—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
*   **–î–∞–Ω–Ω—ã–µ (Volumes)**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–Ω–µ—à–Ω–∏–º —Ç–æ–º–∞–º –ë–î (`db_data`) –∏ Directus (`uploads`). –≠—Ç–æ –≤–µ—Ä–Ω—É–ª–æ –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (18 –ø–æ–∑–∏—Ü–∏–π).
*   **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.prod.yml` –∏ `.env` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º.

### 2. FAQ –∏ API Logic
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–¥–µ–ª FAQ –±—ã–ª –ø—É—Å—Ç, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ (Next.js) –ø—ã—Ç–∞–ª—Å—è –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ `http://backend:8000` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∞–¥—Ä–µ—Å–∞ Docker, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: 
    *   –í `lib/api.ts` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞: –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `https://api.td-rss.ru`, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `http://backend:8000`.
    *   `NEXT_PUBLIC_API_URL` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ `https://api.td-rss.ru`.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: FAQ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ.

### 3. AmoCRM
*   **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —Ç–æ–∫–µ–Ω (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ **2031 –≥–æ–¥–∞**). –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ª–∏–¥–æ–≤ –∏–∑-–∑–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
*   **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –¢–µ—Å—Ç–æ–≤—ã–µ –ª–∏–¥—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≤–æ—Ä–æ–Ω–∫—É ¬´–ö–ª–∏–µ–Ω—Ç—ã –û–û–û¬ª.

## üìã –ü–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é (Final Testing)
- **–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ—Ä–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –Ω–∞ —Å–∞–π—Ç–µ.
- **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã TMA (Telegram Mini App) —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @Russtanko2026_bot.
- **Email**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ `zakaz@tdrusstankosbyt.ru`.
- **UX**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç.

---
*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤ /docs/ARCHITECTURE.md –∏ /docs/DEPLOYMENT.md*
