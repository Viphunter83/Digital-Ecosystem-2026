# Deployment Guide (Dokploy)

Проект использует **Dokploy** для управления контейнерами и автоматизации деплоя. 

## 1. Процесс обновления
Деплой настроен по модели **Push-to-Deploy**:
1. Разработчик делает пуш в ветку `main`.
2. Dokploy на сервере фиксирует изменения, делает `git pull` и пересобирает контейнеры согласно `docker-compose.prod.yml`.

> [!IMPORTANT]
> Перед пушем убедитесь, что Git-статус на сервере «чистый». Если вы правили файлы (например, `docker-compose.prod.yml`) вручную через SSH, пуш может не пройти.

## 2. Синхронизация окружения `.env`
Файлы `.env` не хранятся в Git. 
- **Локально**: Используйте `.env` для разработки.
- **На сервере**: Переменные управляются через панель управления Dokploy (секция Environment Variables).
- **Синхронизация**: При добавлении новых ключей (например, API ключи AI), их нужно добавить **и локально, и в Dokploy**.

## 3. Инфраструктура
- **Traefik**: Используется в качестве Reverse Proxy. Конфигурация роутинга и SSL (LetsEncrypt) находится в метках (labels) сервисов в `docker-compose.prod.yml`.
- **База данных**: PostgreSQL (pgvector) работает в отдельном контейнере. Данные хранятся в Docker Volume `db_data`.

## 4. Порядок миграций
Миграции применяются автоматически при запуск бэкенда через скрипт `apply_migrations.py`.
Скрипт проверяет папки:
- `supabase/migrations/`
- `packages/database/migrations/`
