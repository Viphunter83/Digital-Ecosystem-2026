#!/usr/bin/expect -f
set timeout 30
set ip "194.156.118.128"
set user "root"
set password "MaksimNiretin2602201213!"
set b64 "dmVyc2lvbjogJzMuOCcKCnNlcnZpY2VzOgogIGJhY2tlbmQ6CiAgICBidWlsZDoKICAgICAgY29udGV4dDogLgogICAgICBkb2NrZXJmaWxlOiBpbmZyYS9Eb2NrZXJmaWxlLmJhY2tlbmQKICAgIHBvcnRzOgogICAgICAtICI4MDAwOjgwMDAiCiAgICBlbnZfZmlsZToKICAgICAgLSAuZW52CiAgICBlbnZpcm9ubWVudDoKICAgICAgLSBEQVRBQkFTRV9VUkw9cG9zdGdyZXNxbDovLyR7UE9TVEdSRVNfVVNFUn06JHtQT1NUR1JFU19QQVNTV09SRH1AZGI6NTQzMi8ke1BPU1RHUkVTX0RCfQogICAgICAtIFBZVEhPTlBBVEg9L2FwcAogICAgY29tbWFuZDogc2ggLWMgInB5dGhvbiBhcHBzL2JhY2tlbmQvc2NyaXB0cy9hcHBseV9taWdyYXRpb25zLnB5ICYmIHB5dGhvbiBhcHBzL2JhY2tlbmQvc2NyaXB0cy9zZWVkX2RlbW8ucHkgJiYgdXZpY29ybiBhcHBzLmJhY2tlbmQuYXBwLm1haW46YXBwIC0taG9zdCAwLjAuMC4wIC0tcG9ydCA4MDAwIC0tcHJveHktaGVhZGVycyAtLWZvcndhcmRlZC1hbGxvdy1pcHM9JyonIgogICAgZGVwZW5kc19vbjoKICAgICAgLSBkYgogICAgcmVzdGFydDogYWx3YXlzCiAgICBsYWJlbHM6CiAgICAgIC0gdHJhZWZpay5kb2NrZXIubmV0d29yaz1kb2twbG95LW5ldHdvcmsKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTEtd2ViLnJ1bGU9SG9zdChgYXBpLjE5NC4xNTYuMTE4LjEyOC5uaXAuaW9gKQogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMS13ZWIuZW50cnlwb2ludHM9d2ViCiAgICAgIC0gdHJhZWZpay5odHRwLnNlcnZpY2VzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMS13ZWJzZWN1cmUubG9hZGJhbGFuY2VyLnNlcnZlci5wb3J0PTgwMDAKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTEtd2ViLnNlcnZpY2U9cnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDExLXdlYgogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMS13ZWIubWlkZGxld2FyZXM9cmVkaXJlY3QtdG8taHR0cHNAZmlsZQogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMS13ZWJzZWN1cmUucnVsZT1Ib3N0KGBhcGkuMTk0LjE1Ni4xMTguMTI4Lm5pcC5pb2ApCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDExLXdlYnNlY3VyZS5lbnRyeXBvaW50cz13ZWJzZWN1cmUKICAgICAgLSB0cmFlZmlrLmh0dHAuc2VydmljZXMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDExLXdlYnNlY3VyZS5sb2FkYmFsYW5jZXIuc2VydmVyLnBvcnQ9ODAwMAogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMS13ZWJzZWN1cmUuc2VydmljZT1ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTEtd2Vic2VjdXJlCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDExLXdlYnNlY3VyZS50bHMuY2VydHJlc29sdmVyPWxldHNlbmNyeXB0CiAgICAgIC0gdHJhZWZpay5lbmFibGU9dHJ1ZQogICAgbmV0d29ya3M6CiAgICAgIC0gZG9rcGxveS1uZXR3b3JrCgogIGJvdDoKICAgIGJ1aWxkOgogICAgICBjb250ZXh0OiAuCiAgICAgIGRvY2tlcmZpbGU6IGFwcHMvYm90L0RvY2tlcmZpbGUKICAgIGVudl9maWxlOgogICAgICAtIC5lbnYKICAgIGVudmlyb25tZW50OgogICAgICAtIFRFTEVHUkFNX0JPVF9UT0tFTj0ke1RFTEVHUkFNX0JPVF9UT0tFTn0KICAgICAgLSBCQUNLRU5EX1VSTD1odHRwOi8vYmFja2VuZDo4MDAwCiAgICAgIC0gUFlUSE9OUEFUSD0vYXBwCiAgICBkZXBlbmRzX29uOgogICAgICAtIGJhY2tlbmQKICAgIHJlc3RhcnQ6IGFsd2F5cwogICAgbmV0d29ya3M6CiAgICAgIC0gZG9rcGxveS1uZXR3b3JrCgogIGZyb250ZW5kOgogICAgYnVpbGQ6CiAgICAgIGNvbnRleHQ6IC4KICAgICAgZG9ja2VyZmlsZTogaW5mcmEvRG9ja2VyZmlsZS5mcm9udGVuZAogICAgICBhcmdzOgogICAgICAgIE5FWFRfUFVCTElDX0FQSV9VUkw6IC9hcGkKICAgIHBvcnRzOgogICAgICAtICIzMDAwOjMwMDAiCiAgICBlbnZpcm9ubWVudDoKICAgICAgLSBORVhUX1BVQkxJQ19BUElfVVJMPS9hcGkKICAgICAgLSBCQUNLRU5EX1VSTD1odHRwOi8vYmFja2VuZDo4MDAwCiAgICAgIC0gUE9SVD0zMDAwCiAgICByZXN0YXJ0OiBhbHdheXMKICAgIGxhYmVsczoKICAgICAgLSB0cmFlZmlrLmRvY2tlci5uZXR3b3JrPWRva3Bsb3ktbmV0d29yawogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAwOS13ZWIucnVsZT1Ib3N0KGBhcHAuMTk0LjE1Ni4xMTguMTI4Lm5pcC5pb2ApCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDA5LXdlYi5lbnRyeXBvaW50cz13ZWIKICAgICAgLSB0cmFlZmlrLmh0dHAuc2VydmljZXMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDA5LXdlYi5sb2FkYmFsYW5jZXIuc2VydmVyLnBvcnQ9MzAwMAogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAwOS13ZWIuc2VydmljZT1ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMDktd2ViCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDA5LXdlYi5taWRkbGV3YXJlcz1yZWRpcmVjdC10by1odHRwc0BmaWxlCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDA5LXdlYnNlY3VyZS5ydWxlPUhvc3QoYGFwcC4xOTQuMTU2LjExOC4xMjgubmlwLmlvYCkKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMDktd2Vic2VjdXJlLmVudHJ5cG9pbnRzPXdlYnNlY3VyZQogICAgICAtIHRyYWVmaWsuaHR0cC5zZXJ2aWNlcy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMDktd2Vic2VjdXJlLmxvYWRiYWxhbmNlci5zZXJ2ZXIucG9ydD0zMDAwCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDA5LXdlYnNlY3VyZS5zZXJ2aWNlPXJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAwOS13ZWJzZWN1cmUKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMDktd2Vic2VjdXJlLnRscy5jZXJ0cmVzb2x2ZXI9bGV0c2VuY3J5cHQKICAgICAgLSB0cmFlZmlrLmVuYWJsZT10cnVlCiAgICBuZXR3b3JrczoKICAgICAgLSBkb2twbG95LW5ldHdvcmsKCiAgZGI6CiAgICBpbWFnZTogYW5rYW5lL3BndmVjdG9yCiAgICBwb3J0czoKICAgICAgLSAiNTQzMjo1NDMyIgogICAgZW52aXJvbm1lbnQ6CiAgICAgIC0gUE9SVDdSRVNfVVNFUj0ke1BPU1RHUkVTX1VTRVJ9CiAgICAgIC0gUE9TVEdSRVNfUEFTU1dPUkQ9JHtQT1NUR1JFU19QQVNTV09SRH0KICAgICAgLSBQT1NUR1JFU19EQj0ke1BPU1RHUkVTX0RCfQogICAgdm9sdW1lczoKICAgICAgLSBkYl9kYXRhOi92YXIvbGliL3Bvc3RncmVzcWwvZGF0YQogICAgcmVzdGFydDogYWx3YXlzCiAgICBuZXR3b3JrczoKICAgICAgLSBkb2twbG95LW5ldHdvcmsKCiAgcmVkaXM6CiAgICBpbWFnZTogcmVkaXM6YWxwaW5lCiAgICBwb3J0czoKICAgICAgLSAiNjM3OTo2Mzc5IgogICAgdm9sdW1lczoKICAgICAgLSByZWRpc19kYXRhOi9kYXRhCiAgICBoZWFsdGhjaGVjazoKICAgICAgdGVzdDogWyAiQ01EIiwgInJlZGlzLWNsaSIsICJwaW5nIiBdCiAgICAgIGludGVydmFsOiAxMHMKICAgICAgdGltZW91dDogNXMKICAgICAgcmV0cmllczogNQogICAgcmVzdGFydDogYWx3YXlzCiAgICBuZXR3b3JrczoKICAgICAgLSBkb2twbG95LW5ldHdvcmsKCiAgZGlyZWN0dXM6CiAgICBpbWFnZTogZGlyZWN0dXMvZGlyZWN0dXM6bGF0ZXN0CiAgICBwb3J0czoKICAgICAgLSAiODA1NTo4MDU1IgogICAgdm9sdW1lczoKICAgICAgLSBkaXJlY3R1c191cGxvYWRzOi9kaXJlY3R1cy91cGxvYWRzCiAgICBkZXBlbmRzX29uOgogICAgICAtIGRiCiAgICBlbnZfZmlsZToKICAgICAgLSAuZW52CiAgICBlbnZpcm9ubWVudDoKICAgICAgS0VZOiAiJHtESVJFQ1RVU19LRVl9IgogICAgICBTRUNSRVQ6ICIke0RJUkVDVFVTX1NFQ1JFVH0iCiAgICAgIEFETUlOX0VNQUlMOiAiJHtBRE1JTl9FTUFJTH0iCiAgICAgIEFETUlOX1BBU1NXT1JEOiAiJHtBRE1JTl9QQVNTV09SRH0iCiAgICAgIERCX0NMSUVOVDogInBnIgogICAgICBEQl9IT1NUOiAiZGIiCiAgICAgIERCX1BPUlQ6ICI1NDMyIgogICAgICBEQl9EQVRBQkFTRTogIiR7UE9TVEdSRVNfREJ9IgogICAgICBEQl9VU0VSOiAiJHtQT1NUR1JFU19VU0VSfSIKICAgICAgREJfUEFTU1dPUkQ6ICIke1BPU1RHUkVTX1BBU1NXT1JEfSIKICAgICAgQ09SU19FTkFCTEVEOiAidHJ1ZSIKICAgICAgQ09SU19PUklHSU46ICJ0cnVlIgogICAgcmVzdGFydDogYWx3YXlzCiAgICBsYWJlbHM6CiAgICAgIC0gdHJhZWZpay5kb2NrZXIubmV0d29yaz1kb2twbG95LW5ldHdvcmsKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTAtd2ViLnJ1bGU9SG9zdChgYWRtaW4uMTk0LjE1Ni4xMTguMTI4Lm5pcC5pb2ApCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDEwLXdlYi5lbnRyeXBvaW50cz13ZWIKICAgICAgLSB0cmFlZmlrLmh0dHAuc2VydmljZXMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDEwLXdlYi5sb2FkYmFsYW5jZXIuc2VydmVyLnBvcnQ9ODA1NQogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMC13ZWIuc2VydmljZT1ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTAtd2ViCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDEwLXdlYi5taWRkbGV3YXJlcz1yZWRpcmVjdC10by1odHRwc0BmaWxlCiAgICAgIC0gdHJhZWZpay5odHRwLnJvdXRlcnMucnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDEwLXdlYnNlY3VyZS5ydWxlPUhvc3QoYGFkbWluLjE5NC4xNTYuMTE4LjEyOC5uaXAuaW9gKQogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMC13ZWJzZWN1cmUuZW50cnlwb2ludHM9d2Vic2VjdXJlCiAgICAgIC0gdHJhZWZpay5odHRwLnNlcnZpY2VzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMC13ZWJzZWN1cmUubG9hZGJhbGFuY2VyLnNlcnZlci5wb3J0PTgwNTUKICAgICAgLSB0cmFlZmlrLmh0dHAucm91dGVycy5ydXNzdGFua28tcnVzc3RhbmtvcHJvZC1jb2x5amEtMjgwMTAtd2Vic2VjdXJlLnNlcnZpY2U9cnVzc3RhbmtvLXJ1c3N0YW5rb3Byb2QtY29seWphLTI4MDEwLXdlYnNlY3VyZQogICAgICAtIHRyYWVmaWsuaHR0cC5yb3V0ZXJzLnJ1c3N0YW5rby1ydXNzdGFua29wcm9kLWNvbHlqYS0yODAxMC13ZWJzZWN1cmUudGxzLmNlcnRyZXNvbHZlcj1sZXRzZW5jcnlwdAogICAgICAtIHRyYWVmaWsuZW5hYmxlPXRydWUKICAgIG5ldHdvcmtzOgogICAgICAtIGRva3Bsb3ktbmV0d29yawoKdm9sdW1lczoKICBkYl9kYXRhOgogIHJlZGlzX2RhdGE6CiAgZGlyZWN0dXNfdXBsb2FkczoKCgpuZXR3b3JrczoKICBkb2twbG95LW5ldHdvcms6CiAgICBleHRlcm5hbDogdHJ1ZQo="

spawn ssh -o StrictHostKeyChecking=no $user@$ip "echo '$b64' | base64 -d > /etc/dokploy/compose/russtanko-russtankoprod-colyja/code/docker-compose.prod.yml"

expect {
  "password:" {
    send "$password\r"
    exp_continue
  }
  eof
}
